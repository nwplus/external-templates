name: Continuous deployment to firebase hosting

on:
  push: 
    branches: [ cmd-f_dev ]

jobs:
  firebase_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: Print ref
        run: echo ${GITHUB_REF#refs/*/}

      - name: Set up firebase
        run: |
          sudo npm install -g firebase-tools --unsafe
          firebase use ${{ secrets.PROD_FIREBASE_PROJECT_ID }} --token ${{ secrets.FIREBASE_TOKEN }}

      - name: Build website
        run: yarn cache clean && yarn install && yarn build:prod

      - name: Deploy to site associated with branch name
        run: firebase deploy --only hosting:${GITHUB_REF#refs/*/} --non-interactive --token ${{ secrets.FIREBASE_TOKEN }}